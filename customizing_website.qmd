---
title: "Customizing and deploying sites"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

### functions

```{r}

#find text in functions
find.text <- function(pattern, fun.only = FALSE, path = "./R", ignore.case = T, file.pattern = "\\.md$")
  {
rfiles <- list.files(pattern = file.pattern, path = path, full.names = T, all.files = T, recursive = TRUE)
  
#check where a word is found in each function an return the name of function where it was found and the time
res <- NULL
w <- 1
for(f in rfiles){
  # print(f)
  x <- readLines(f)
  y <- grep(pattern, x, fixed = T, value = T)
  if(length(y) > 0) {
    print(gsub(pattern = file.pattern, "",  (basename(f)))) 
    for(i in y) print(i)
  }
  
  w = w + 1
}
}


#replace text
repl.text <- function(pattern, repl, path = "./R", ignore.case = T, file.pattern = "\\.md$", fixed = FALSE){
  rfiles <- list.files(pattern = file.pattern, path = path, full.names = T, all.files = T, recursive = TRUE)

    for(f in rfiles){
  
    #find and replace
      x <- readLines(f)
      y <- gsub(pattern = pattern, replacement = repl, x = x, fixed = fixed)
      cat(y, file = f, sep="\n")
  
  #reread
      x <- readLines(f)
      w <- grep(repl, x, fixed = fixed, value = T, ignore.case = T)
      if(length(w)>0) {
          print(f) 
        for(i in w) print(i)
          }
    }
}

add.pdf <- function(path = "./content/publication", file.pattern = "\\.md$", rm.doi = TRUE){
  
  rfiles <- list.files(pattern = file.pattern, path = path, full.names = T, all.files = T, recursive = TRUE)

  results <- NULL
    for(f in rfiles){
  
    #find and replace
      x <- readLines(f)
      
      if (rm.doi)
        x <- x[!grepl("^doi:", x)]
      
      if (!any(grepl("^url_pdf", x))){
        
        url_pdf <- paste0("url_pdf: ", basename(dirname(f)), ".pdf")
        y <- x[-length(x)]
        y <- c(y, url_pdf, x[length(x)])
        cat(y, file = f, sep="\n")
        
        results[length(results) + 1] <- url_pdf
        }
    }
  
  print(results)
}

```

# Basic Customization

From <https://matteocourthoud.github.io/post/website/> Site clone from: <https://www.yabin-da.com> <https://github.com/dayabin/PersonalWebisteNewVersion>

The basic files that you want to modify to customize your website are the following:

    config/_default/config.yaml: general website information
    config/_default/params.yaml: website customization
    config/_default/menus.yaml: top bar / menu customization
    content/authors/admin/_index.md: personal information files

```{r, eval= FALSE}

blogdown::serve_site()

```

To add citations <https://github.com/wowchemy/hugo-academic-cli>

download your papers from mendeley in .bib format into the main website project folder (export.bib)

```{r Python}
blogdown::stop_server()
# .rs.restartR()

# Sys.sleep(3)
# delete folders
# dirs <- list.dirs("./content/publication", full.names = TRUE)[-1]
# for (i in dirs)
# unlink(i, recursive = TRUE)

# run on terminal

system("academic import --bibtex export.bib")

# find.text(pattern = "- Marcelo Araya-Salas",  ignore.case = T, path = "./content/publication", file.pattern = "\\.md$")

repl.text(pattern = "repository$", repl = "Repository", path = "./content/publication", 
          )

repl.text(pattern = "- Marcelo Araya Salas", repl = "- admin", path = "./content/publication", file.pattern = "\\.md$")

repl.text(pattern = "- M Araya-Salas", repl = "- admin", path = "./content/publication", file.pattern = "\\.md$")

repl.text(pattern = "- M. Araya-Salas", repl = "- admin", path = "./content/publication", file.pattern = "\\.md$")

repl.text(pattern = "- Marcelo Araya-salas", repl = "- admin", path = "./content/publication", file.pattern = "\\.md$")

blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
```

In content/publication/ look into common R files and replace your name (Marcelo Araya-Salas) for admin

# add pdfs

PDFs should be placed in static/uploads/ with the same name of the folder containing the citation info

```{r}


add.pdf()


```

# fixed 
.section-heading h1{margin:0 0 10px 0}
.section-heading h1{margin:0 0 10px 0;position:sticky;position:-webkit-sticky;top:150px;}

